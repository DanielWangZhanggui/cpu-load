box:
  id: python:2.7-slim
build:
  steps:
    - pip-install
    - script:
      name: download artifacts
      code: |
        python download.py
publish:
  box: 
    id: tomcat
    tag: 8.5.23-jre8
  steps:
    - script: 
      name: Build Image
      code: |
        rm -rf /usr/local/tomcat/webapps/*
        cp ./cpu-load-0.0.1-SNAPSHOT.war /usr/local/tomcat/webapps/ROOT.war
    - internal/docker-push:
      username: $DOCKER_USER
      password: $DOCKER_PASSWORD
      repository: burning1docker/cpuload
      tag: $WERCKER_GIT_COMMIT
      ports: 8080
      cmd: "/usr/local/tomcat/bin/catalina.sh run"
deploy:
    steps:
      - kubectl:
        server: $K8MASTER
        token: $K8TOKEN
        insecure-skip-tls-verify: true
        command: set image deployments/cpuload cpuload=burning1docker/cpuload:$WERCKER_GIT_COMMIT -n burningluffy1
    